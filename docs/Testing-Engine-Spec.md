# Testing Engine Spec — Learn

Цель: обеспечить **логически непротиворечивые** тесты по пакетным предложениям.

---

## 1) Концепция и принципы

### 1.1 Ключевая проблема (what we fix)

Пункты состава могут входить в несколько пакетов/уровней.  
Если задать вопрос формата “В каком пакете находится X?” и разрешить только один ответ — появляется логическая ловушка.

### 1.2 Принцип “No logical traps”

- Если правильных вариантов > 1 → **Multiple choice**  
- Если хотим однозначность → используем вопросы “на отличия уровней”, например:
  - “Что добавляется при переходе Базовый → Оптимальный в пакете Y?”

---

## 2) Типы вопросов (минимум)

### 2.1 Single choice

**Когда использовать:** только если корректный ответ один.  
**Проверка:** `picked ∈ answer[]`.

**UI:** tap по варианту → сразу показать correct/wrong + explanation.

### 2.2 Multiple choice

**Когда использовать:** если правильных пакетов несколько.  
**Проверка:** множества равны: `Set(picked) == Set(answer)`.

**UI:** можно выбрать несколько → “Проверить” → подсветка:
- correct варианты: зелёный
- выбранные неверные: жёлтый/оранжевый

**Ограничение качества:** correct вариантов не больше 3–4.

### 2.3 True/False (boolean)

Используем только если утверждение однозначно проверяемо по базе знаний.  
**Важно:** избегать слов “обычно/часто/иногда”.

### 2.4 Matching

**Сценарий:** сопоставление категорий/примеров.  
**UI:** список слева + dropdown справа (надёжно в mobile).  
**Проверка:** все пары совпали.

### 2.5 Ordering

**Сценарий:** порядок уровней или шагов процесса.  
**UI:** up/down (надёжнее drag’n’drop в WebView).  
**Проверка:** массив равен эталону.

### 2.6 Fill-in-the-blank

**Сценарий:** короткий термин, строгое множество допустимых ответов.  
**Проверка:** `normalize(input) ∈ normalize(accepted[])`.

---

## 3) Валидация контента (контент‑QA)

### 3.1 Правила формулировок

- один критерий правильности
- нет “все вышеперечисленное”
- нет двойных отрицаний
- нет “зависит” без условий
- длина вопроса: 1–2 строки, “stem” отдельной строкой

### 3.2 Дистракторы

- правдоподобные (из того же домена)
- но однозначно неверные при данных правилах
- не повторяются внутри одного вопроса

### 3.3 Ссылки на знания

Каждый вопрос должен иметь:
- `explanation` (почему)
- `ref` (deeplink на материал в приложении: `#/package/...` или `#/library?search=...`)

---

## 4) Скоринг и результаты

### 4.1 Скоринг (MVP)

- 1 вопрос = 1 балл
- accuracy = `correct / total`

### 4.2 Разбор

В Results:
- общая точность
- разрез по темам (`topic`)
- “что повторить” (по неправильным ответам; кликабельный `ref`)

---

## 5) Рандомизация и защита от заучивания

- `generated` тесты: новый набор вопросов на каждый запуск
- shuffle вариантов ответа
- pool вопросов ограничивается правилами качества (не берем “слишком пересекающиеся” пункты)

---

## 6) Генераторы вопросов (в проекте)

### 6.1 packageByBank

**Идея:** по пункту состава определить пакет.  
**Алгоритм:**
1) строим индекс `item -> packages[]`  
2) если `len(packages)==1` → single choice  
3) если `len(packages) in [2..3]` → multiple choice  
4) иначе (слишком много) → не используем этот item

### 6.2 upgradeDiff

**Идея:** отличие уровней внутри пакета (однозначно).  
**Алгоритм:**
1) берём `added = to - from`  
2) correct = random(added)  
3) distractors = random(from-items)  
4) single choice

---

## 7) Пример контент‑пакета (3 темы × 10 вопросов)

Реализовано в репозитории: **`data/tests.js` → QUESTION_BANKS.exam_30**  
Темы:
1) Специализация пакетов  
2) Апгрейд: Базовый → Оптимальный  
3) Инструменты и материалы

**Метаданные каждого вопроса:**
- `difficulty`
- `tags`
- `time_estimate_s`
- `explanation`
- `ref`

---

## 8) Расширения (v1/v2)

- частичные баллы за multiple choice (опц.)
- таймер и попытки
- “weak topics” (рекомендации по статистике)
- редактор вопросников
